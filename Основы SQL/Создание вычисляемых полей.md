# Создание вычисляемых полей

## Вычисляемые поля

**Вычисляемые поля** — поля, значения которых не хранятся в таблице базы данных, а вычисляются автоматически на основе данных из других полей таблицы.

## **Объединение значений полей**

Наиболее простым примером вычисляемого поля является поле, которое содержит объединение значений из нескольких полей таблицы

### Функция `CONCAT`

В SQL для объединения нескольких значений используется функция `CONCAT()`. Она принимает переменное количество аргументов, выполняет их конкатенацию и возвращает полученный результат. Результатом функции `CONCAT()` всегда является строка, однако аргументы функции могут принадлежать любым типам, поскольку функция неявно преобразует все аргументы в строки перед объединением.

```sql
SELECT CONCAT(artist, ' - ', trackname)
FROM Songs;
```

```sql
+----------------------------------+
| CONCAT(artist, ' - ', trackname) |
+----------------------------------+
| Heart - Crazy On You             |
| The Sounds - My Lover            |
| Kate Bush - Running up That Hill |
| The Sounds - Thrill              |
| Morrissey - Spent the Day in Bed |
+----------------------------------+
```

Чтобы было красивее можно сделать так:

```sql
SELECT CONCAT(artist, ' - ', trackname) as song
FROM Songs
ORDER BY song DESC;
```

### Функция **`CONCAT_WS`**

В отличие от функции `CONCAT()`, она не только объединяет значения, но и добавляет между ними разделитель. Разделитель указывается в качестве первого аргумента, объединяемые значения — в качестве всех остальных.

```sql
SELECT CONCAT_WS(', ', id, artist, trackname) AS song
FROM Songs;
```

```sql
+------------------------------------+
| song                               |
+------------------------------------+
| 1, Heart, Crazy On You             |
| 2, The Sounds, My Lover            |
| 3, Kate Bush, Running up That Hill |
| 4, The Sounds, Thrill              |
| 5, Morrissey, Spent the Day in Bed |
+------------------------------------+
```

## **Выполнение математических вычислений**

В качестве примера напишем запрос, который выполняет именно такую операцию и определяет общую сумму, которую принесли продажи каждой песни.

Результатом приведенного ниже запроса:

```sql
SELECT artist, trackname,
       price * quantity AS revenue
FROM Songs;
```

является:

```
+------------+----------------------+------------+
| artist     | trackname            | revenue    |
+------------+----------------------+------------+
| Heart      | Crazy On You         | 62908.00   |
| The Sounds | My Lover             | 13674.00   |
| Kate Bush  | Running up That Hill | 15874.00   |
| The Sounds | Thrill               | 2740.00    |
| Morrissey  | Spent the Day in Bed | 2823985.00 |
+------------+----------------------+------------+
```

Псевдонимы вычисляемых полей, как и псевдонимы обычных полей, не могут быть использованы в блоке оператора `WHERE` для фильтрации записей.

При необходимости выполнить фильтрацию по вычисляемому полю выражение, определяющее это поле, придется продублировать.

Результатом приведенного ниже запроса:

```sql
SELECT artist, trackname,
       price * quantity AS revenue
FROM Songs
WHERE price * quantity > 20000;
```