# Нормальные формы

| ID | Имя | Фамилия | Предметы |
| --- | --- | --- | --- |
| 1 | Билл | Гейтс | Информатика,Маркетинг |
| 2 | Алан | Тьюринг | Криптография,Математика |
| 3 | Эдгар | Кодд | Информатика,Математика |

## Нормализация данных

**Нормализация** — это процесс организации данных в реляционных БД в соответствии с определенными правилами, которые делаются БД более гибкой и избавляя от избыточности данных и потенциальных ошибках

В таблице ниже есть избыточность

| ID | Имя | Фамилия | Предмет |
| --- | --- | --- | --- |
| 1 | Билл | Гейтс | Информатика |
| 2 | Алан | Тьюринг | Информатика |
| 3 | Эдгар | Кодд | Математика |

Если, например, у предмета **Информатика** сменится название на **Комп. науки**, то у всех студентов придется менять этот предмет

<aside>
<img src="https://ucarecdn.com/6b58fd6f-f20b-4e9d-9bf5-cfdec5035d50/" alt="https://ucarecdn.com/6b58fd6f-f20b-4e9d-9bf5-cfdec5035d50/" width="40px" /> Ошибки, которые могут возникнуть при работе с ненормализованной базой данных, называются **аномалиями**. Выделяют аномалии вставки, удаления и модификации, которые возникают при соответствующих операциях.

</aside>

## Нормальные формы

Существует несколько наборов правил для нормализации БД. Каждый такой набор называется **нормальной формой**. Если БД соблюдается первый набор правил, то считается, что она в первой нормальной форме. Каждая следующая нормальная форма содержит все более жесткие правила. Если БД находится в какой-то нормальной форме, то она лишена определенного набора аномалий

<aside>
<img src="https://ucarecdn.com/6b58fd6f-f20b-4e9d-9bf5-cfdec5035d50/" alt="https://ucarecdn.com/6b58fd6f-f20b-4e9d-9bf5-cfdec5035d50/" width="40px" /> Приведение базы данных к какой-либо конкретной нормальной форме обязательно требует, чтобы эта база данных уже находилась в предыдущей нормальной форме.

</aside>

Существует 5 основных нормальный форм: **первая, вторая, третья, четвертая, пятая**. Иногда выделяют еще 3: **шестая, Бойса-Кодда, доменно-ключевая**.

БД считается нормализованной, если она находится как минимум в третей нормальной форме. Нормализация до 3 формы считается классикой, нормализация до 4 встречается редко.

### Первая нормальная форма

Здесь следующие правила:

- В таблице не должно быть полей с одинаковым смыслом
- В каждой ячейке таблицы должно находится одиночное несоставное значение
- Таблица должна иметь табличный ключ

Для примера рассмотрим такую таблицу

| ID | Имя | Фамилия | Первый предмет | Второй предмет |
| --- | --- | --- | --- | --- |
| 1 | Билл | Гейтс | Информатика | Маркетинг |
| 2 | Алан | Тьюринг | Криптография | Математика |
| 3 | Эдгар | Кодд | Информатика | Математика |

Она не соответствует первой нормальной форме, так как содержит поля с одинаковым смыслом: `Первый предмет` и `Второй предмет` . То есть, если появится студент с 4 предметами, то придется полностью менять таблицу. Потенциально проблему можно решить так:

| ID | Имя | Фамилия | Предметы |
| --- | --- | --- | --- |
| 1 | Билл | Гейтс | Информатика, Маркетинг |
| 2 | Алан | Тьюринг | Криптография, Математика |
| 3 | Эдгар | Кодд | Информатика, Математика |

Однако таблица все равно не нормализована, так как содержит составные значения. Можно решить путем дублирование студента и предмета

| ID | Имя | Фамилия | Предмет |
| --- | --- | --- | --- |
| 1 | Билл | Гейтс | Информатика |
| 1 | Билл | Гейтс | Маркетинг |
| 2 | Алан | Тьюринг | Криптография |
| 2 | Алан | Тьюринг | Математика |
| 3 | Эдгар | Кодд | Информатика |
| 3 | Эдгар | Кодд | Математика |

Теперь таблица в первой нормальной форме.

### Вторая нормальная форма

Вторая нормальная форма является продолжением первой и включает в себя правила:

- Таблица должна находится в первой нормальной форме
- Каждое неключевое поле таблицы должно зависеть только от полного первичного ключа, то есть от всех его полей

Для примера рассмотрим таблицу в первой нормальной форме и приведем ее ко 2

| ID | Имя | Фамилия | Предмет | Оценка |
| --- | --- | --- | --- | --- |
| 1 | Билл | Гейтс | Информатика | 5 |
| 1 | Билл | Гейтс | Маркетинг | 4 |
| 2 | Алан | Тьюринг | Криптография | 5 |
| 2 | Алан | Тьюринг | Математика | 5 |
| 3 | Эдгар | Кодд | Информатика | 5 |
| 3 | Эдгар | Кодд | Математика | 5 |

Эта таблица не находится во 2 НФ, так как в ней ей зависимость поля `ОЦЕНКА` от полей `ПРЕДМЕТ` и `ID` , а также зависимость полей `ИМЯ` и `ФАМИЛИЯ` от поля `ID` . Здесь первичный составной ключ `ID, ПРЕДМЕТ` , а имя и фамилия зависят только от части ПК, что нарушает правила 2 НФ. Решение может быть такое

| ID | Имя | Фамилия |
| --- | --- | --- |
| 1 | Билл | Гейтс |
| 2 | Алан | Тьюринг |
| 3 | Эдгар | Кодд |

| ID | Предмет | Оценка |
| --- | --- | --- |
| 1 | Информатика | 5 |
| 1 | Маркетинг | 4 |
| 2 | Криптография | 5 |
| 2 | Математика | 5 |
| 3 | Информатика | 5 |
| 3 | Математика | 5 |

Теперь мы имеем две таблицы, каждая из которых находится во второй нормальной форме

### Третья нормальная форма

Правила:

- Таблица должна находится во 2 НФ
- Каждое неключевое поле таблицы должны зависеть только от первичного ключа и ни от какого другого неключевого поля

| ID | Имя | Фамилия | Должность | Зарплата |
| --- | --- | --- | --- | --- |
| 1 | Билл | Гейтс | Программист | 120 000 |
| 2 | Алан | Тьюринг | Криптограф | 100 000 |
| 3 | Эдгар | Кодд | Программист | 120 000 |

ПК в ней — `ID` . Размер ЗП определяется должностью. Есть зависимость между полями `Должность` и `Зарплата` . Это аномалия модификации. Например, Алан захочет стать программистом, но его ЗП останется прежней. 

| Код должности | Должность | Зарплата |
| --- | --- | --- |
| 1 | Программист | 120 000 |
| 2 | Криптограф | 100 000 |

| ID | Имя | Фамилия | Код занимаемой должности |
| --- | --- | --- | --- |
| 1 | Билл | Гейтс | 1 |
| 2 | Алан | Тьюринг | 2 |
| 3 | Эдгар | Кодд | 1 |